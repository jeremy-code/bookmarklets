javascript:(()=>{var d=/^\/r\/[A-Za-z0-9][_A-Za-z0-9]{2,20}\/comments\//,l=async()=>{let t=new URL(window.location.href).searchParams.get("url");if(!t)throw new Error(`No image URL found in query string ${window.location.href}`);let e=await fetch(t);if(!e.ok)throw new Error(`${e.status}: ${e.statusText}`);window.open(URL.createObjectURL(await e.blob()))},c=async()=>{let e=(await fetch(new URL("./.json?limit=1",window.location.href)).then(o=>o.json()))[0].data.children[0].data,r=async o=>{let a=o.media?.reddit_video.dash_url;if(!a)throw new Error("MPD URL not found in Reddit video metadata");let n=new DOMParser().parseFromString(await(await fetch(a)).text(),"text/xml").querySelector("AdaptationSet[contentType='video']");if(n===null)throw new Error("Adaptation set not found");let s=(n.querySelector(`Representation[height="${n.getAttribute("maxHeight")}"] > BaseURL`)??n.querySelector("Representation:last-of-type > BaseURL"))?.textContent?.trim();return new URL(`./${s}`,a)};if(!e.is_reddit_media_domain)throw new Error("This is not a Reddit media domain URL.");let i=await fetch(e.is_video?await r(e):e.url);if(!i.ok)throw new Error(`${i.status}: ${i.statusText}`);window.open(URL.createObjectURL(await i.blob()),"_blank")};try{if(!window.location.hostname.endsWith("reddit.com"))throw new Error("This is not a Reddit page.");if(window.location.pathname==="/media")l();else if(d.test(window.location.pathname))c();else throw new Error("Reddit media not found")}catch(t){t instanceof Error&&alert(`An error has occurred: ${t.message}`)}})();
